<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.24">

  <title>index</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section id="section" class="slide level2 center" data-background-image="images/kendal-hnysCJrPpkc-unsplash.jpg" style="color: whitesmoke">
<h2></h2>
<div class="r-fit-text">
<p>Functional Reproducibility</p>
</div>
<p><br> <br></p>
<p><a href="https://robsteranium.github.io/functional-reproducibility/" style="font-weight: 100; font-size: 1em; color: whitesmoke">robsteranium.github.io/functional-reproducibility</a></p>
<p><span style="font-weight: 100; font-size: 1em;">robin@infonomics.ltd.uk</span></p>
<div class="footer">
<p>Photo by <a href="https://unsplash.com/@hikendal?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Kendal</a> on <a href="https://unsplash.com/photos/green-ferns-on-a-black-background-hnysCJrPpkc?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></p>
</div>
</section>
<section id="section-1" class="slide level2 center">
<h2></h2>
<dl>
<dt>Reproducible <span style="font-weight: normal; font-style: italic">adj.</span></dt>
<dd>
(of a measurement, experiment etc) capable of being reproduced at a different time or place and by different people.
</dd>
</dl>
<div class="footer">
<p><a href="https://en.wiktionary.org/wiki/reproducible">en.wiktionary.org/wiki/reproducible</a></p>
</div>
<aside class="notes">
<p>Have you ever written the perfect program?</p>
<p>Has it still run <em>unchanged</em> 6 months later?</p>
<p>Can your colleagues run it without you?</p>
<p>Just because your analysis is executable, it doesn’t mean the results are reproducible.</p>
<p>Data ages. Libraries change. Machines differ. Servers go down. Bits rot. Entropy is inescapable.</p>
<p>We can learn how to engineer reproducibility by drawing on techniques from functional programming and the MLOps movement. The code examples are provided in R <!-- and Python --> but the lessons apply to any language.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-2" class="slide level2" data-background-color="#b00400" data-background-image="images/benevolent-monster.jpg">
<h2></h2>
<div class="footer" style="color: #FFFFFF">
<p>NASA (2011) “Benevolent Monster” Solar Flare</p>
</div>
<aside class="notes">
<p>Physics tells us that energy can’t be created or destroyed but that doesn’t make it an infinitely enduring resource.</p>
<p>We can only <em>use</em> energy when we transform it from one form to another.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-3" class="slide level2" data-background-color="#ecd9bd" data-background-image="images/wattschen-dampfmaschine-cropped.jpg" data-background-size="auto 80%">
<h2></h2>
<div class="footer">
<p>Schreinmer, R.M. (1912) Deutsches Museum, München</p>
<p>© The Board of Trustees of the Science Museum released under a CC BY-NC-SA 4.0 license at <a href="https://collection.sciencemuseumgroup.org.uk/objects/co50970/portfolio-of-drawings-etc-used-in-the-reproduction-of-watts-rotative-engine-1788-drawings">collection.sciencemuseumgroup.org.uk</a></p>
</div>
<aside class="notes">
<p>We can turn the chemical energy stored in coal into heat by burning it. A fire turns water into steam. Steam expands to drive pistons becoming mechanical energy that we can use. We do work by transforming energy.</p>
<p>But once the water has become steam and expanded it can’t expand again unless it is first condensed by cooling.</p>
<p>Though we’ve not lost energy we have created <em>entropy</em>. Entropy is energy that’s not available to do work with.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-4" class="slide level2 center">
<h2></h2>
<div class="footer">
<p><a href="https://commons.wikimedia.org/wiki/File:Increasing_disorder.svg">Increasing Disorder CC BY Htkym</a></p>
</div>

<img data-src="images/increasing_disorder.svg" class="r-stretch quarto-figure-center"><p class="caption">Increasing Disorder CC BY Htkym</p><aside class="notes">
<p>In order to use energy we need order in the universe. As depicted on the left, we have an ordered division between a cold place A and a hot place B.</p>
<p>Once we’ve made use of the difference the heat evens out and now both places are merely warm, as depicted on the right.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-5" class="slide level2 center">
<h2></h2>
<div class="footer">
<p><a href="https://commons.wikimedia.org/wiki/File:Maxwell%27s_demon.svg">Maxwell’s Demon CC BY Htkym</a></p>
</div>

<img data-src="images/maxwells-demon.svg" class="r-stretch quarto-figure-center"><p class="caption">Maxwell’s Demon CC BY Htkym</p><aside class="notes">
<p>The picture shows a thought experiment. Maxwell’s daemon opens a door between two vessels letting the faster gas molecules pass and closing it just in time to keep the slower ones separated. In doing so it appears to defy the 2nd law of thermodynamics by creating order from disorder and reversing entropy.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-6" class="slide level2" data-background-image="images/ruins.jpg">
<h2></h2>
<div class="footer">
<p>Photo by <a href="https://unsplash.com/@dmey503?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Dan Meyers</a> on <a href="https://unsplash.com/photos/abandoned-industrial-building-interior-Wy0RUh-1DyM?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></p>
</div>
<aside class="notes">
<p>In an isolated system, absent any magical demons, while the amount of energy remains the same, <em>entropy</em> is always increasing. We can create pockets of order but the overall trend is towards disorder. Decay is inevitable.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-7" class="slide level2" data-background-color="#000000" data-background-image="images/webb-deep-field.png">
<h2></h2>
<div class="footer">
<p><a href="https://webbtelescope.org/contents/media/images/2023/127/01H1Q1CGJD51CDJTK2NHJWD06M">Advanced Deep Extragalactic Survey</a> - NASA, ESA, CSA</p>
<p>Brant Robertson (UC Santa Cruz), Ben Johnson (CfA), Sandro Tacchella (Cambridge), Marcia Rieke (University of Arizona), Daniel Eisenstein (CfA)</p>
</div>
<aside class="notes">
<p>Eventually our universe will reach a state of complete disorder. A uniform cold vacuum with no exploitable differences. The heat death of the universe.</p>
<blockquote>
<p>This is the way the world ends, not with a bang but a whimper - T. S. Eliot</p>
</blockquote>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-8" class="slide level2" data-background-color="#000000" data-background-transition="fade" data-transition-speed="slow">
<h2></h2>
<aside class="notes">
<p>Of course we don’t generally worry about this cosmic tragedy and I’m not saying that the work we do attempting to bring order to data is futile. Far from it.</p>
<p>This is merely a reminder that we should not have the hubris to expect our programs will work forever while our physical reality tends inexorably towards disorder. No-one, not even the greatest engineers or scientists, are exempt.</p>
<p>We have reason for hope though. Not least because we have a tool that exists beyond the physical constraints of reality…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-9" class="slide level2 center" data-background-color="#000000" data-transition="fade">
<h2></h2>
<p><span style="font-size: 200%"><span class="math display">\[f(x) = \frac{1}{\sigma \sqrt{2\pi} } e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2}\]</span></span></p>
<aside class="notes">
<p>The mathematics we use is pure and eternal. Functions are infinitely reproducible.</p>
<p>Here’s the probability density function of the normal distribution.</p>
<p>Pi and Eulers number are <em>real</em> constants. Given the same mean and standard deviation this formula will always plot the same bell-curve and so always return the same probability density for any given value of x.</p>
<p>This is all very well, but - as beautiful as this formula is - it’s not much use on it’s own.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-10" class="slide level2" data-transition="slide-in">
<h2></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">plot</span>(dnorm, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">main=</span><span class="st">"The Standard Normal Distribution"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="index_files/figure-revealjs/rnorm-density-1.png" width="960" class="r-stretch"><aside class="notes">
<p>We can put that maths to use by using R to plot density of the normal distribution. Here I’ve used the default mean of zero and standard deviation of 1 which gives us the “Standard Normal”.</p>
<p>In practical terms we need to do computations to use maths and computers are certainly subject to entropy.</p>
<p>Computation sits on top of a whole stack of dependencies from your code though packages and programming languages down to machine instructions and the bare metal itself. None of this is permanent.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<div class="footer">
<p><a href="https://www.theregister.com/2016/03/23/npm_left_pad_chaos/">theregister.com/2016/03/23/npm_left_pad_chaos/</a></p>
<p>CC-BY-NC 2.5 <a href="https://xkcd.com/2347/">xkcd.com/2347/</a></p>
</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/leftpad.png"></p>
<figcaption>theregister.com/2016/03/23/npm_left_pad_chaos/</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/dependency.png"></p>
<figcaption>CC-BY-NC 2.5 xkcd.com/2347/</figcaption>
</figure>
</div>
</div>
</div>
</div>
<aside class="notes">
<p>Consider the tale of Leftpad… not even a dozen lines of JavaScript was removed from NPM in 2016. It brought front-end development to a screeching halt as build failures cascaded across the web.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-11" class="slide level2" data-background-image="images/gallery-404.png">
<h2></h2>
<aside class="notes">
<p>Consider Gallery 404, a museum of obsolete digital art <!-- that was exhibited at the last Berlin Creative Code Stammtisch-->. None of these art works are reproducible any longer. Server’s go down. Domains expire. Adobe flash is long gone.</p>
<p>Some museums now require digital art to be supplied along with working hardware (and backup systems) so that it can continue running over the longer term.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="engineering-reproducibility-in-the-face-of-entropy" class="slide level2 center">
<h2>Engineering reproducibility <br> in the face of entropy</h2>
<aside class="notes">
<p>So, how can we guard against this inevitable bit rot?</p>
<p>How can we design and engineer our code to be reproducible?</p>
<p>It’s time to leave the metaphysics and consider some more practical guidance.</p>
<p>As I alluded to earlier, we can turn to maths for help. In code that manifests most directly in terms of <em>functional programming</em>. I’ll explain some lessons from that approach then go on to describe ideas from software engineering that have found a home in the data world under neologisms like “DataOps”, “MLOps” or “ModelOps”. Outside of the marketing hype we can think of this as just rigorous data engineering.</p>
<p>Let’s start though, with a question…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="isnt-code-reproducible" class="slide level2">
<h2>Isn’t code reproducible?</h2>
<aside class="notes">
<p>Which of these statements is reproducible?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Reading from a database:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>users <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbReadTable</span>(connection, <span class="st">"users"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Drawing a sample at random:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a>coin_tosses <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"heads"</span>,<span class="st">"tails"</span>), <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Writing to a filesystem:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(data, <span class="st">"output.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section>
<section id="none-of-them-are-reproducible" class="title-slide slide level1 center">
<h1>None of them are reproducible!</h1>
<aside class="notes">
<p>None of them are. This was a trick question!</p>
<p>Reproducibility requires that doing the same thing gives you the same result.</p>
<p>None of those statements - even writing to disk - are reproducible.</p>
<p>Let’s explore why and what you can do about it.</p>
<p>We saw the definition at the beginning, but what does it really mean to be reproducible?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="pure-functions-are-reproducible" class="slide level2">
<h2>Pure functions are reproducible</h2>
<div class="cell" data-fig-height="6" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<svg width="960" height="576" viewbox="0.00 0.00 98.75 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none; display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 94.75,-184 94.75,4 -4,4"></polygon>
<!-- Input -->
<g id="node1" class="node">
<title>Input</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-162" rx="31.34" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-157.8" font-family="Source Sans Pro" font-size="14.00">Input</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-90" rx="45.25" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-85.8" font-family="Source Sans Pro" font-size="14.00">Function</text>
</g>
<!-- Input&#45;&gt;Function -->
<g id="edge1" class="edge">
<title>Input-&gt;Function</title>
<path fill="none" stroke="black" d="M45.37,-143.7C45.37,-135.98 45.37,-126.71 45.37,-118.11"></path>
<polygon fill="black" stroke="black" points="48.87,-118.1 45.37,-108.1 41.87,-118.1 48.87,-118.1"></polygon>
</g>
<!-- Output -->
<g id="node3" class="node">
<title>Output</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-18" rx="37.72" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-13.8" font-family="Source Sans Pro" font-size="14.00">Output</text>
</g>
<!-- Function&#45;&gt;Output -->
<g id="edge2" class="edge">
<title>Function-&gt;Output</title>
<path fill="none" stroke="black" d="M45.37,-71.7C45.37,-63.98 45.37,-54.71 45.37,-46.11"></path>
<polygon fill="black" stroke="black" points="48.87,-46.1 45.37,-36.1 41.87,-46.1 48.87,-46.1"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<aside class="notes">
<p>Pure functions <em>are</em> reproducible.</p>
<p>The output of a pure function only depends on it’s input. The result doesn’t change if it’s calculated a second time or by another person; for the same input you always get the same output. You could replace a function call with it’s return value in your program. This is known as <em>referential transparency</em>. Indeed you could replace the function body with a lookup table that records the relevant output for each input.</p>
<p>A pure function has no side effects. Running it doesn’t change the state of the world, the only consequence is the output value it returns. Pure functions are <em>idempotent</em>, you can run them as many times as you like and get the same result.</p>
<p>Pure functions are composable. If you combine one pure function with another then the result will also be pure. A pipeline composed of functions is much like one giant function.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="side-effects-arent-reproducible" class="slide level2">
<h2>Side-effects aren’t reproducible</h2>
<div class="cell" data-fig-height="6" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<svg width="960" height="576" viewbox="0.00 0.00 225.58 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none; display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 221.58,-184 221.58,4 -4,4"></polygon>
<!-- Function -->
<g id="node1" class="node">
<title>Function</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-90" rx="45.25" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-85.8" font-family="Source Sans Pro" font-size="14.00">Function</text>
</g>
<!-- SideEffect -->
<g id="node2" class="node">
<title>SideEffect</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="163.37" cy="-90" rx="54.41" ry="18"></ellipse>
<text text-anchor="middle" x="163.37" y="-85.8" font-family="Source Sans Pro" font-size="14.00">Side Effect</text>
</g>
<!-- Function&#45;&gt;SideEffect -->
<g id="edge3" class="edge">
<title>Function-&gt;SideEffect</title>
<path fill="none" stroke="black" d="M80.87,-101.36C91.53,-103.3 102.2,-103.92 112.86,-103.22"></path>
<polygon fill="black" stroke="black" points="113.51,-106.67 123.09,-102.14 112.77,-99.71 113.51,-106.67"></polygon>
</g>
<!-- Output -->
<g id="node4" class="node">
<title>Output</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-18" rx="37.72" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-13.8" font-family="Source Sans Pro" font-size="14.00">Output</text>
</g>
<!-- Function&#45;&gt;Output -->
<g id="edge4" class="edge">
<title>Function-&gt;Output</title>
<path fill="none" stroke="black" d="M45.37,-71.7C45.37,-63.98 45.37,-54.71 45.37,-46.11"></path>
<polygon fill="black" stroke="black" points="48.87,-46.1 45.37,-36.1 41.87,-46.1 48.87,-46.1"></polygon>
</g>
<!-- SideEffect&#45;&gt;Function -->
<g id="edge2" class="edge">
<title>SideEffect-&gt;Function</title>
<path fill="none" stroke="black" d="M123.09,-77.86C112.42,-76.31 101.76,-76.09 91.09,-77.18"></path>
<polygon fill="black" stroke="black" points="90.27,-73.77 80.87,-78.64 91.26,-80.7 90.27,-73.77"></polygon>
</g>
<!-- Input -->
<g id="node3" class="node">
<title>Input</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="45.37" cy="-162" rx="31.34" ry="18"></ellipse>
<text text-anchor="middle" x="45.37" y="-157.8" font-family="Source Sans Pro" font-size="14.00">Input</text>
</g>
<!-- Input&#45;&gt;Function -->
<g id="edge1" class="edge">
<title>Input-&gt;Function</title>
<path fill="none" stroke="black" d="M45.37,-143.7C45.37,-135.98 45.37,-126.71 45.37,-118.11"></path>
<polygon fill="black" stroke="black" points="48.87,-118.1 45.37,-108.1 41.87,-118.1 48.87,-118.1"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<aside class="notes">
<p>This is all very well in theory but we can’t continue piping data around in circles <em>ad nauseum</em>. At some point we have to interact with the outside world - read from a database, deploy a website, email a report. In practice we need side-effects.</p>
<p>Side-effects are intended consequences that happen outside of a function or a pipeline’s output. We also use the term “side-effect” to refer to causes that exist outside of a function or a pipeline’s direct inputs, that is to say <em>non-local state</em>.</p>
<p>These side-effects are what make our pipelines useful allowing them to interact with the world. They’re also what cause our pipelines to become non-reproducible.</p>
<p>This mightn’t be very obvious if it’s the first time you’re hearing this, so let’s look at some examples.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="non-local-state-makes-functions-sensitive-to-context" class="slide level2">
<h2>Non-local state makes functions sensitive to context</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-2"><a href=""></a></span>
<span id="cb5-3"><a href=""></a>show_count <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb5-4"><a href=""></a>  <span class="fu">cat</span>(<span class="st">"Count is"</span>, counter) <span class="co"># concatenate and print</span></span>
<span id="cb5-5"><a href=""></a>}</span>
<span id="cb5-6"><a href=""></a></span>
<span id="cb5-7"><a href=""></a><span class="fu">show_count</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count is 0</code></pre>
</div>
</div>
<p>Sometime later…</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a><span class="fu">show_count</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count is 1</code></pre>
</div>
</div>
<aside class="notes">
<p>Here we can see a side-effecting <code>show_count()</code> function. It implicitly depends on the <code>counter</code> variable that is defined in the global scope. This means that it’s result depends on the context in which it is run.</p>
<p>Any time you call <code>show_count()</code> you could get a different result. It isn’t reproducible. If the value of <code>counter</code> changes, then so does the result.</p>
<p>This function also has no return value. The call to <code>cat</code> or <code>print</code> is itself a side-effect. In this case a <code>NULL</code> is returned invisibly. We can’t use it in a reproducible pipeline.</p>
<p>This might seem a bit contrived, but you could instead imagine the counter as being a data frame that you’re mutating in place.</p>
<p>Let’s refactor this into a pure function.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="explicit-inputs-outputs-let-us-separate-code-and-context" class="slide level2">
<h2>Explicit inputs/ outputs let us separate code and context</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href=""></a></span>
<span id="cb9-3"><a href=""></a>describe_count <span class="ot">&lt;-</span> <span class="cf">function</span>(count) {</span>
<span id="cb9-4"><a href=""></a>  <span class="fu">paste</span>(<span class="st">"Count is"</span>, count) <span class="co"># string interpolation</span></span>
<span id="cb9-5"><a href=""></a>}</span>
<span id="cb9-6"><a href=""></a></span>
<span id="cb9-7"><a href=""></a><span class="fu">print</span>(<span class="fu">describe_count</span>(counter))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Count is 0"</code></pre>
</div>
</div>
<p>Sometime later…</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-2"><a href=""></a></span>
<span id="cb11-3"><a href=""></a><span class="fu">print</span>(<span class="fu">describe_count</span>(counter))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Count is 1"</code></pre>
</div>
</div>
<div class="footer">
<p><a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">The Value of Values - Rich Hickey @ JaxConf 2012</a></p>
</div>
<aside class="notes">
<p>We define <code>describe_count</code> in terms of the <code>count</code> value. Now the dependency on this variable is explicit. Given the same input, this function will always return the same output. It’s reproducible. Indeed it now returns an explicit output value reproducibly. The output is now data, not a side-effect so we can use it elsewhere. The call to <code>print</code> happens outside of the core logic of text rendering.</p>
<p>Again this example is a bit contrived but the same rationale motivates the <code>broom</code> package which extracts tabular data from models so that you can manipulate results programmatically where the base R <code>summary</code> method only prints it’s tabular output to the screen.</p>
<p>The code on this slide has essentially the same functionality as before but because it’s now reproducible it’s much easier to reason about. We’ve made the dependency on the context explicit rather than implicitly relying on global state. The focus of the function is on the <em>value</em> of the <code>count</code>, not the variable and it’s place in memory.</p>
<p>Context mutations like this are exactly what’s happening when you reassign a variable or values within a data frame.</p>
<p>This example might look trivial but state mutation is a pernicious source of subtle bugs. Mutating state in place may yield savings in computer memory, but it imposes costs on the human capacity to reason about the flow of data through your code as you try to keep a track of a running program in your mind.</p>
<p>Pure functions operating on immutable data are reproducible. You lose these guarantees once your pipeline has side-effects and state mutations.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-context-isnt-always-apparent" class="slide level2">
<h2>The context isn’t always apparent</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>toss_coins <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"heads"</span>,<span class="st">"tails"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href=""></a></span>
<span id="cb13-3"><a href=""></a><span class="fu">toss_coins</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tails" "heads" "tails" "tails" "tails"</code></pre>
</div>
</div>
<p>Sometime later…</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="fu">toss_coins</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tails" "heads" "heads" "heads" "heads"</code></pre>
</div>
</div>
<div class="footer">
<p>Pseudo-randomness from a <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne Twister</a></p>
</div>
<aside class="notes">
<p>Some side effects are not as obvious.</p>
<p>The <code>sample</code> function depends not just on the arguments you pass it but also the state of a random number generator (RNG).</p>
<p>In software the RNG is not truly random but rather a pseudo-random process. It gives highly erratic results but follows <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">a predictable process</a> if you know the starting state. The starting state is seeded by some source that varies such as the date or a hardware source like <code>/dev/random</code> which <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/random.c?id=refs/tags/v3.15.6#n52">collects noise from device drivers</a>.</p>
<p>This is a side-effect for our function, causing it’s output to differ each time it’s run.</p>
<p>Indeed each time I render <em>this document</em> I get a different set of coin tosses. Although executable, this example (and a consequence the whole document) isn’t reproducible.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="we-can-make-the-context-explicit" class="slide level2">
<h2>We can make the context explicit</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># set state deterministically</span></span>
<span id="cb17-2"><a href=""></a></span>
<span id="cb17-3"><a href=""></a><span class="fu">toss_coins</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tails" "tails" "tails" "tails" "heads"</code></pre>
</div>
</div>
<p>Sometime later…</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># reset the state again</span></span>
<span id="cb19-2"><a href=""></a></span>
<span id="cb19-3"><a href=""></a><span class="fu">toss_coins</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tails" "tails" "tails" "tails" "heads"</code></pre>
</div>
</div>
<div class="footer">
<p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/random.c?id=refs/tags/v3.15.6#n52">How hardware seeds <code>/dev/random</code></a></p>
</div>
<aside class="notes">
<p>We can make this function call reproducible by fixing the initial state of the random number generator to a constant value with <code>set.seed</code>.</p>
<p>This level of purity may be helpful from an engineering perspective (for example this slide has a consistent checksum meaning it can be cached), but it would completely undermine certain analytical procedures. For example in cross-validation where we want to see the test/ train split vary to ensure we’re not over-fitting a statistical model. We forego reproducibility in resampling in an effort to achieve reproducibility on out-of-sample predictions.</p>
<p>We might not always want perfect reproducibility. The key is in making that choice consciously.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="io-is-side-effecting" class="slide level2">
<h2>I/O is side-effecting</h2>
<p>Input is a side-effect</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a>df <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"/home/robin/data-290224-final.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Output is a side-effect</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(result, <span class="st">"~/results/output.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<aside class="notes">
<p>A more ubiquitous source of side-effects is I/O (input/ output). This doesn’t just apply to third-party APIs or our own database, even the filesystem is non-local state as far as our programs are concerned.</p>
<p>It’s not uncommon to see pipelines or notebooks start like this.</p>
<p>The filepath is idiosyncratic and this code won’t be reproducible on other people’s machines unless they coincidentally have a user called <code>robin</code> with this file in the home directory. Indeed this probably won’t be reproducible on Robin’s machine at a future date unless care is taken to keep that file in place.</p>
<p>More generally, even if the filepath is dependable, there’s no guarantee that the content of the CSV file itself won’t change.</p>
<p>Even the <em>writing</em> of files is not reproducible. This function alone can’t guarantee that the destination directory <code>~/results</code> exists.</p>
<p>These problems become all the more apparent with APIs or databases where network interruptions and other external change can jeopardise the reproducibility of your program.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="dependency-injection-is-explicit" class="slide level2">
<h2>Dependency-injection is explicit</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="fu">library</span>(DBI)</span>
<span id="cb23-2"><a href=""></a></span>
<span id="cb23-3"><a href=""></a>my_conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Instead of relying on global state:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb24-2"><a href=""></a>  <span class="fu">dbReadTable</span>(my_conn, <span class="st">"users"</span>)</span>
<span id="cb24-3"><a href=""></a>}</span>
<span id="cb24-4"><a href=""></a></span>
<span id="cb24-5"><a href=""></a><span class="fu">get_data</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We can make dependencies explicit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(connection) {</span>
<span id="cb25-2"><a href=""></a>  <span class="fu">dbReadTable</span>(connection, <span class="st">"users"</span>)</span>
<span id="cb25-3"><a href=""></a>}</span>
<span id="cb25-4"><a href=""></a></span>
<span id="cb25-5"><a href=""></a><span class="fu">get_data</span>(my_conn)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<aside class="notes">
<p>The problem isn’t that these side-effects exist; they’re necessary.</p>
<p>The problem is that when they’re implicit they tend to hide dependencies.</p>
<p>We can make them explicit with techniques like dependency injection. The function receives a database connection, for example, as an input instead of relying on it existing in the program’s global state.</p>
<p>Now the function declares it’s requirements. It draws attention to potential side-effects and forces us to think about them. Here we can see that <code>get_data</code> will need us to manage the connection’s lifecycle rather than taking it for granted.</p>
<p>The code is more modular. We can re-use this code within the same program allowing us to get users from a test or staging database as well.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="execution-context-is-explicit" class="slide level2">
<h2>Execution context is explicit</h2>
<p>Command-line arguments</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href=""></a><span class="ex">R</span> <span class="at">-f</span> pipeline.r input.csv output.parquet</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Environment variables</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href=""></a><span class="fu">env</span> DB=<span class="st">"http://user:pw@localhost:1337"</span> R <span class="at">-f</span> pipeline.r</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Configuration data</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href=""></a><span class="ex">R</span> <span class="at">-f</span> pipeline.r configuration.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="footer">
<p><a href="https://12factor.net/">https://12factor.net/</a></p>
</div>
<aside class="notes">
<p>Likewise we can pull side-effects through to the very edges of our pipelines, passing in state (like data or configuration) only from the outermost execution context.</p>
<p>This means the pipeline no longer has to be concerned with coordinating state. We may want some graceful error handling, but the pipeline itself should be context-free and reproducible.</p>
<p>Extending this practice into the execution context itself is what leads to the Infrastructure as Code and GitOps/ DevOps movement where machines and services can themselves be provisioned reproducibly from declarative configuration.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="functional-pipeline-configured-context" class="slide level2">
<h2>Functional pipeline,<br>configured context</h2>
<div class="cell" data-fig-height="5" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<svg width="960" height="480" viewbox="0.00 0.00 283.28 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none; display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 279.28,-184 279.28,4 -4,4"></polygon>
<!-- Function1 -->
<g id="node1" class="node">
<title>Function1</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="131.42" cy="-162" rx="50.4" ry="18"></ellipse>
<text text-anchor="middle" x="131.42" y="-157.8" font-family="Source Sans Pro" font-size="14.00">Function1</text>
</g>
<!-- Function2 -->
<g id="node5" class="node">
<title>Function2</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="131.42" cy="-90" rx="50.4" ry="18"></ellipse>
<text text-anchor="middle" x="131.42" y="-85.8" font-family="Source Sans Pro" font-size="14.00">Function2</text>
</g>
<!-- Function1&#45;&gt;Function2 -->
<g id="edge2" class="edge">
<title>Function1-&gt;Function2</title>
<path fill="none" stroke="black" d="M131.42,-143.7C131.42,-135.98 131.42,-126.71 131.42,-118.11"></path>
<polygon fill="black" stroke="black" points="134.92,-118.1 131.42,-108.1 127.92,-118.1 134.92,-118.1"></polygon>
</g>
<!-- Input -->
<g id="node2" class="node">
<title>Input</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="31.42" cy="-162" rx="31.34" ry="18"></ellipse>
<text text-anchor="middle" x="31.42" y="-157.8" font-family="Source Sans Pro" font-size="14.00">Input</text>
</g>
<!-- Input&#45;&gt;Function1 -->
<g id="edge1" class="edge">
<title>Input-&gt;Function1</title>
<path fill="none" stroke="black" d="M63.06,-162C65.67,-162 68.28,-162 70.89,-162"></path>
<polygon fill="black" stroke="black" points="70.95,-165.5 80.95,-162 70.95,-158.5 70.95,-165.5"></polygon>
</g>
<!-- Function3 -->
<g id="node3" class="node">
<title>Function3</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="131.42" cy="-18" rx="50.4" ry="18"></ellipse>
<text text-anchor="middle" x="131.42" y="-13.8" font-family="Source Sans Pro" font-size="14.00">Function3</text>
</g>
<!-- Output -->
<g id="node4" class="node">
<title>Output</title>
<ellipse fill="#f0f0ff" stroke="black" stroke-width="0" cx="237.42" cy="-18" rx="37.72" ry="18"></ellipse>
<text text-anchor="middle" x="237.42" y="-13.8" font-family="Source Sans Pro" font-size="14.00">Output</text>
</g>
<!-- Function3&#45;&gt;Output -->
<g id="edge4" class="edge">
<title>Function3-&gt;Output</title>
<path fill="none" stroke="black" d="M181.94,-18C184.37,-18 186.81,-18 189.25,-18"></path>
<polygon fill="black" stroke="black" points="189.28,-21.5 199.28,-18 189.28,-14.5 189.28,-21.5"></polygon>
</g>
<!-- Function2&#45;&gt;Function3 -->
<g id="edge3" class="edge">
<title>Function2-&gt;Function3</title>
<path fill="none" stroke="black" d="M131.42,-71.7C131.42,-63.98 131.42,-54.71 131.42,-46.11"></path>
<polygon fill="black" stroke="black" points="134.92,-46.1 131.42,-36.1 127.92,-46.1 134.92,-46.1"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="footer">
<p><a href="https://www.destroyallsoftware.com/screencasts/catalog/functional-core-imperative-shell">Functional core, imperative shell</a></p>
</div>
<aside class="notes">
<p>Pursuing a separation of these concerns - what Gary Bernhart has called <a href="https://www.destroyallsoftware.com/screencasts/catalog/functional-core-imperative-shell">functional core, imperative shell</a> - leads us to a point where all of the dependencies are captured explicitly and their values gathered together into configuration.</p>
<p>Here we have a pipeline composed of pure-functions with all the necessary side-effects contained to explicitly configured contexts at each end.</p>
<p>This makes it easier to maintain reproducible code. When the code is changed you can see how the pieces fit together and what the consequences of a refactoring are on the rest of the pipeline’s code base. When the infrastructure changes you may be lucky enough to only need to change the configuration and not the code at all.</p>
<p>This also helps sub-divide the code into well-factored modules as each component explicitly declares its requirements making them easier to test in isolation. The preceding example makes it trivial to pass in a test database connection.</p>
<p>You’ll note that this hasn’t really solved the ultimate cause of our problems. As I explained at the outset, we shouldn’t expect to ever be able to fix the rest of the universe in place. The best we can do is hope to contain the unreliable bits, pushing them to the edges so we can carve out a space to pursue reproducibility. A small domain where we, like Maxwell’s Daemon, can reverse entropy and bring order to our world.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="lessons-from-software-development" class="title-slide slide level1 center">
<h1>Lessons from software development</h1>
<aside class="notes">
<p>We can go a step further than the above and strive for reproducibility in our interaction with data outside of the pipeline.</p>
<p>In these final slides I’ll discuss some lessons the data community can learn from software development. In particular version control and continuous delivery.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-12" class="slide level2" data-background-image="images/kazuend-cCthPLHmrzI-unsplash.jpg">
<h2></h2>
<h2 style="color: whitesmoke">
Versions are values over time
</h2>
<div class="footer">
<p><span style="color: whitesmoke"> Photo by <a href="https://unsplash.com/@kazuend?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">kazuend</a> on <a href="https://unsplash.com/photos/body-river-surrounded-by-dress-cCthPLHmrzI?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a> </span></p>
</div>
<aside class="notes">
<p>We’ve seen that the functional approach leads us to immutability - data that is unchanging. Steps in your pipeline can only communicate with one another through their arguments and return values. We aren’t mutating the objects passing through the pipeline or the global state. The intermediate values are immutable.</p>
<p>But we need to change things to do useful work over time as the external context changes, for example as upstream data sources are updated. How do we cope when the upstream source is mutable? We can use versions to control external change.</p>
<p>Versions identify immutable states of data as it evolves over time.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-13" class="slide level2 center">
<h2></h2>
<img data-src="images/heraclitus.jpg" class="r-stretch" style="float:right">
<blockquote>
<p>It is impossible to step in the same river twice</p>
</blockquote>
<p>Heraclitus c.a. 500 BC, possibly apocryphal</p>
<aside class="notes">
<p>What is a river? A place? Some water?</p>
<p>As you stand in a stream you can feel the water flowing past your feet. You won’t step into that same water again yet we still think of that place as the river.</p>
<p>You can’t step in the same river twice. Time marches on. The river is formed of a different body water and you too will be a different person.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-14" class="slide level2" data-background-image="images/heraclitus-1.png">
<h2></h2>
<aside class="notes">
<p>Here’s Heraclitus standing in a river…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-15" class="slide level2" data-background-image="images/heraclitus-2.png">
<h2></h2>
<aside class="notes">
<p>… different gallons of water flow round his feet…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-16" class="slide level2" data-background-image="images/heraclitus-3.png">
<h2></h2>
<aside class="notes">
<p>… what’s constant is the riverbed.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-17" class="slide level2" data-background-image="images/heraclitus-4.png">
<h2></h2>
<aside class="notes">
<p>It’s helpful for us to distinguish between the water and the riverbed.</p>
<p>This is how we name rivers. The name refers to the river bed, not the water in it!</p>
<p>We can apply this as a metaphor for data pipelines. We distinguish the output from each instance of it.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section-18" class="slide level2 center">
<h2></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href=""></a><span class="ex">alisonhorst/palmerpenguins</span> v0.1.0</span>
<span id="cb29-2"><a href=""></a></span>
<span id="cb29-3"><a href=""></a><span class="ex">s3://alisonhorst/palmerpenguins.csv?versionId=c19a904</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<aside class="notes">
<p>Ultimately the version is identified uniquely only by the values in the data. This becomes cumbersome so we need a more succinct version identifier. We can identity versions by a name formed of two parts. One is a location or label we can use as a reference. The other is the version or state in time. The named output and versioned instances.</p>
<p>You should certainly use a version control tool like <code>git</code> to manage your code and models but line-by-line diffs and patches would be a very inefficient way to store data versions. For data, the parallel here isn’t to source control but to software releases.</p>
<p>Data should be treated as an artifact, frozen in time. Artifact repositories will let you record provenance - for example which version of the source or which run of the pipeline was responsible.</p>
<p>You don’t need a bespoke tool, even a simple S3 bucket will let you update a key in place while it records the version history. Some databases support versioning natively or you can create your own snapshots.</p>
<p>This version history let’s us retrieve the exact conditions for a pipeline run so we can rollback and reproduce the results.</p>
<p>Be wary of any upstream source that can mutate over time without providing some means of identifying and distinguishing versions. You can of course defend against this to an extent by keeping a track of the data you receive with hashes or recording copies of API transactions in caches.</p>
<p>Be a good data citizen and surface versioning information about your own outputs to downstream consumers so that they might ensure reproducibility in their workflow.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="automation-proves-reproducibility" class="slide level2">
<h2>Automation proves reproducibility</h2>
<img data-src="images/brooms.png" class="r-stretch" style="float:right">
<p>Builds should be:</p>
<ul>
<li class="fragment">deterministic</li>
<li class="fragment">automated</li>
<li class="fragment">ephemeral</li>
</ul>
<aside class="notes">
<p>Just because you can re-run your pipeline locally, it doesn’t prove that it’s reproducible. It’s not demonstrably reproducible until it’s running on ephemeral resources in a build system.</p>
<p>A build system runs your workflow recording the versions of the input data, source code, and output. The pipeline run itself is immutable and identified for posterity with a build number. Done correctly, we don’t need to reproduce the pipeline. This contract serves as a guarantee that you’ll simply get the same result.</p>
<p>CLICK</p>
<p>This requires that the process of assembling your dependencies is automated and reproducible itself. No more hunting through messages or chasing colleagues to find the random excel file that makes the pipeline work. You can’t expect a build server to study the readme and figure it out for themselves. Tacit knowledge must be explicitly codified. You can’t claim that everything’s fine just because “it works on my machine”. The build server is a shared consensus on configuration. A canonical source you can refer to to see how things work. Automation enables collaboration.</p>
<p>CLICK</p>
<p>Building on an ephemeral stack further enforces the discipline by preventing you from relying on state. I’d argue that the success of containerisation comes as much from virtualisation as from the fact that <code>Dockerfile</code>s, for example, automate dependency management down to the operating system level.</p>
<p>CLICK</p>
<p>Don’t just say it’s reproducible. Prove it!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="continuous-everything" class="slide level2">
<h2>Continuous Everything</h2>
<dl>
<dt>Continuous integration</dt>
<dd>
run, test and package code
</dd>
<dt>Continuous training</dt>
<dd>
fit parameters or run experiments
</dd>
<dt>Continuous delivery</dt>
<dd>
deploy models and applications for inference
</dd>
<dt>Continuous evaluation</dt>
<dd>
calculate and monitor performance metrics
</dd>
</dl>
<aside class="notes">
<p>Once you have versioned dependencies and an automated build system you can develop continuously.</p>
<p>A reproducible approach enables continuous cycles as it ensures you can always rebuild something from scratch and let it run idempotently (which is to say repeatedly with the same effect).</p>
<p>By having the discipline to avoid relying on state mutation you can stop worrying about it. When you don’t need to manage or even think about side-effects it’s easy to cancel things, restart them, or even scale horizontally (it’s easier to spin-up concurrent compute resources if you don’t need to coordinate state).</p>
<p>When you can run a system continuously you establish tighter feedback loops. You can understand the impact of changes sooner. Feedback loops help you to iterate quickly and catch issues early to prevent bugs. Repeated execution encourages us to streamline our architecture helping us become more efficient and reduce costs. Continuously exercising and testing your system helps to ensure reliability by giving weakness no space to hide.</p>
<p>There’s an overwhelming choice of Continuous Integration and Continuous Deployment tools - CI/CD - for software development like GitHub actions, Travis or Jenkins. There’s also tools and workflow systems specific to data and model development like Apache Airflow.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="notebooks-as-an-anti-pattern" class="slide level2 center">
<h2>Notebooks as an anti-pattern</h2>
<aside class="notes">
<p>In closing I’d just like to urge caution about the use of Jupyter notebooks.</p>
<p>They’re an effective for exploratory work but I’ve found them to discourage reproducible data analysis.</p>
<p>I should start by saying that exploratory data analysis doesn’t need to be reproducible. We should have the freedom to explore the data interactively as we build up our understanding. We should expect to encounter dead-ends. We should be prepared to throw away code.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="read-evaluate-print-loop" class="slide level2">
<h2>Read-Evaluate-Print-Loop</h2>
<img data-src="images/rstudio.png" class="r-stretch">
<aside class="notes">
<p>This is where REPL-driven development shines. In RStudio, Emacs, or VS Code you have two windows: one to edit code (here on the left) and the other to run it (on the right). You send code from the editor to the console in a read-evaluate-print-loop process: the code it’s read and the evaluated by the R interpreter with the result printed inline in the console, we then loop back to a prompt ready for more input.</p>
<p>The REPL let’s us write code experimentally - we can execute each line to confirm it works as intended. You can tweak code in the REPL console until you’ve got it right. Once you find something you want to use, share or just keep for future reference you can copy it back up to the editor. This let’s us iterate quickly in a carefree, non-reproducible way before finding something worth making reproducible. We can explore methods without needing to worry about architecture.</p>
<p>The Jupyter notebook approach which mixes these two concerns. You end-up with a long document full of half-discarded experiments, which invariably becomes dependent on a non-linear execution sequence that’s impossible to reproduce. People don’t tend to think or write code linearly, and we should embrace that not punish it. Editing is a fundamental programming skill.</p>
<p>Of course you can edit in Jupyter, but it doesn’t arise as naturally because the workflow doesn’t require it.</p>
<p>You can still do literate programming without notebooks. You can integrate code and documentation using alternate tools like <code>quarto</code> for creating articles, presentations or books reproducibly. You can start from your report and develop backwards, pulling the analysis into shape. For those that haven’t tried it yet I’d also recommend building packages in R for any non-trivial code as you can use tools like <code>ROxygen</code> to do documentation-driven design. Before you write any code you start with a vignette explaining how to use it which helps to ensure your syntax and semantics are intuitive and well-factored. You can then pull the implementation into existence. Likewise RDocs let you document each function with examples that are executed as part of the package build process. This let’s you do “specification by example” along with your unit tests.</p>
<p>By separating reproducible literate programming from ephemeral interactive exploration we get the best of both worlds and avoid the risks of one contaminating the other. We can re-run the build process from scratch in an isolated environment and can’t get ourselves twisted up with state mutation. If it’s too slow to rebuild and threatening our fast feedback cycle then we can cache chunks or write intermediate results out to disk.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="engineering-reproducibility" class="slide level2">
<h2>Engineering reproducibility</h2>
<ul>
<li class="fragment">Decay is a physical inevitability but maths is eternal</li>
<li class="fragment">Pure functions on immutable data are reproducible</li>
<li class="fragment">Keep the core of your data flow as pure as possible</li>
<li class="fragment">Extract side-effects and inject dependencies explicitly</li>
<li class="fragment">Use version control for code, models <em>and</em> data</li>
<li class="fragment">Automate workflows for continuous development</li>
</ul>
</section>
<section id="section-19" class="slide level2 center" data-background-image="images/kendal-hnysCJrPpkc-unsplash.jpg" style="color: whitesmoke">
<h2></h2>
<div class="r-fit-text">
<p>Functional Reproducibility</p>
</div>
<p><br> <br></p>
<p><a href="https://robsteranium.github.io/functional-reproducibility/" style="font-weight: 100; font-size: 1em; color: whitesmoke">robsteranium.github.io/functional-reproducibility</a></p>
<p><span style="font-weight: 100; font-size: 1em;">robin@infonomics.ltd.uk</span></p>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>